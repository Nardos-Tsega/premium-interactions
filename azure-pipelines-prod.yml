trigger:
  branches:
    include: ["main"]

pr:
  branches:
    include: ["main"]

variables:
  - group: expo-prod-secrets

stages:
  - stage: Production
    displayName: "Production Builds"
    jobs:
      - job: android_prod
        displayName: "Android Production (AAB)"
        pool:
          vmImage: "macOs"
        steps:
          - checkout: self
          - task: NodeTool@0
            inputs:
              versionSpec: "20.x"
            displayName: "Use Node.js 20"
          - script: npm ci
            displayName: "Install dependencies"
          - script: |
              npx eas --version
              npx eas build --platform android --profile production --non-interactive --no-wait
            displayName: "EAS Build Android (Production)"
            env:
              EXPO_TOKEN: $(EXPO_TOKEN)

      - job: ios_prod
        displayName: "iOS Production"
        pool:
          vmImage: "macos-latest"
        steps:
          - checkout: self
          - task: NodeTool@0
            inputs:
              versionSpec: "20.x"
            displayName: "Use Node.js 20"
          - script: npm ci
            displayName: "Install dependencies"
          - script: |
              npx eas --version
              npx eas build --platform ios --profile production --non-interactive --no-wait
            displayName: "EAS Build iOS (Production)"
            env:
              EXPO_TOKEN: $(EXPO_TOKEN)
